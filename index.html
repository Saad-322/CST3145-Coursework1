<html>

<head>
    <meta charset="UTF-8">
    <title>Lessons</title>
    <!-- Load the Vue.js as a JavaScrip library -->
    <script src="https://unpkg.com/vue"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <div id="app">
        <div v-if="showProduct">
            <div>
                <h1>Lessons</h1>
                <button @click="showCheckout()" v-show="!cartEmpty">
                    <span class="fas fa-shopping-basket"> shopping cart</span>
                    <b>{{cartItemCount}}</b>
                </button>
            </div>

            <ul>
                <div v-for="lesson in lessons" class="lessonlist">
                    <div>
                        <img v-bind:src="lesson.Image" alt="" width="100px" height="100px">
                        <br>
                        Subject: {{ lesson.Subject }} <br>
                        Location: {{ lesson.Location }} <br>
                        Price: £{{ lesson.Price }} <br>
                        Spaces: {{ lesson.Spaces }} <br>
                        <span v-for="n in lesson.Rating" class="fas fa-star"></span>
                        <span v-for="n in 5-lesson.Rating" class="far fa-star"></span> <br><br>
                        <button @click="addToCart(lesson)" :disabled="!canAddToCart(lesson)">Add to cart</button>
                    </div>
                </div>
            </ul>
        </div>
        <div v-else>
            <h1>Shopping Cart</h1>
            <button @click="showCheckout()">
                <span class="fas fa-book"> lessons</span>
            </button>
            <h2>Your cart</h2>
            <ul>
                <div v-for="(lesson, lessons) in cart" class="lessonlist">
                    <img v-bind:src="lesson.Image" alt="" width="100px" height="100px">
                    </span><br>
                    Subject: {{ lesson.Subject }} <br>
                    Location: {{ lesson.Location }} <br>
                    Price: £{{ lesson.Price }} <br>
                    <span v-for="n in lesson.Rating" class="fas fa-star"></span>
                    <span v-for="n in 5-lesson.Rating" class="far fa-star"></span> <br><br>
                    <button @click="removeFromCart(lesson)">Remove from cart</button>
                    <br>
                </div>
            </ul>


            <h2>Details</h2>
            <p>
                <strong>First Name: </strong>
                <input type="text" v-model.trim=order.firstName>
            </p>
            <p>
                <strong>Last Name: </strong>
                <input type="text" v-model.trim=order.lastName>
            </p>
            <p>
                <strong>Phone Number: </strong>
                <input type="text" v-model.trim=order.phoneNumber>
            </p>
            <input type="checkbox" value="gift" v-model=order.gift>
            <label>Ship as Gift?</label>
            <br>
            <br>
            <h3>Order Information</h3>
            <p>First Name: {{order.firstName}}</p>
            <p>Last Name: {{order.lastName}}</p>
            <p>Phone Number: {{order.phoneNumber}}</p>
            <p>Gift: {{order.gift}}</p>
            <button @Click="submitForm" :disabled="!correctOrderDetails">Checkout</button>
        </div>
    </div>


</body>
<script>
    let app = new Vue({
        el: '#app',
        data: {
            sitename: "Lessons",
            showProduct: "false",
            lessons: "",
            cart: [],
            availableStock: 5,
            search: "",
            order: {
                firstName: "",
                lastName: "",
                phoneNumber: "",
                gift: false,
                correct: false
            },
        },
        mounted: function () {
            this.displayData() //this method will execute at pageload
        },
        methods: {
            displayData() {
                fetch('https://cst-3145-cw2.herokuapp.com/collection/lessons').then(
                    function (response) {
                        response.json().then(
                            function (json) {
                                app.lessons = json
                            }
                        )
                    }
                )
            },
            addToCart(lesson) {
                console.log("added to cart");
                this.cart.push(lesson);
                lesson.Spaces--;
            },
            removeFromCart(lesson) {
                let index = this.cart.indexOf(lesson);
                this.cart.splice(index, 1);
                lesson.Spaces++;
            },
            showCheckout() {
                return this.showProduct = this.showProduct ? false : true;
            },
            submitForm() {
                alert("order submitted");
            },
            canAddToCart(lesson) {
                return lesson.Spaces > 0;
            },

        },
        computed: {
            cartItemCount() {
                return this.cart.length || '0';
            },
            cartEmpty() {
                return this.cart.length == 0;
            },
            correctOrderDetails() {
                let letters = /^[a-z]+$/i;
                let numbers = /^[0-9]+$/i;
                if (letters.test(this.order.firstName) &&
                    letters.test(this.order.lastName) && numbers.test(this.order.phoneNumber)) {
                    this.order.correct = true;
                }
                else {
                    this.order.correct = false;
                }
                return this.order.correct;
            },
        }

    })

</script>

</html>