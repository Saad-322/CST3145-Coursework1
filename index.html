<html>

<head>
    <meta charset="UTF-8">
    <title>Lessons</title>
    <!-- Load the Vue.js as a JavaScrip library -->
    <script src="https://unpkg.com/vue"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <script src="lessons.js"></script>
</head>
<style>
    .lessonlist {
        display: inline-block;
        margin-left: 100px;
        margin-top: 50px;
    }
</style>

<body>
    <div id="example-2">
        <div v-if="showProduct">
            <div>
                <h1>Lessons</h1>
                <button @click="showCheckout()" :disabled="cartEmpty">
                    <span class="fas fa-shopping-basket"> shopping cart</span>
                    <b>{{cartItemCount}}</b>
                </button>
                <strong>Search Bar</strong>
                <input type="text" v-model.trim=search>
                <p>You searched for '{{search}}'</p>
            </div>
            <h3>Sort by</h3>
            <input type="radio" value="Subject" name="attributes" v-model=sort.attribute>
            <label>Subject</label><br>
            <input type="radio" value="Location" name="attributes" v-model=sort.attribute>
            <label>Location</label><br>
            <input type="radio" value="Price" name="attributes" v-model=sort.attribute>
            <label>Price</label><br>
            <input type="radio" value="Availability" name="attributes" v-model=sort.attribute>
            <label>Availability</label><br>
            <input type="radio" value="Rating" name="attributes" v-model=sort.attribute>
            <label>Rating</label><br><br>

            <input type="radio" value="ascending" name="order" v-model=sort.sortingOrder>
            <label>Ascending</label><br>
            <input type="radio" value="descending" name="order" v-model=sort.sortingOrder>
            <label>Descending</label>

            <ul>
                <div v-for="lesson in sortedLessons" v-if="lesson.Visible" class="lessonlist">
                    <div >
                        <img v-bind:src="lesson.Image" alt="" width="100px" height="100px">
                        <br>
                        Subject: {{ lesson.Subject }} <br>
                        Location: {{ lesson.Location }} <br>
                        Price: £{{ lesson.Price }} <br>
                        Spaces: {{ lesson.Spaces }} <br>
                        <span v-for="n in lesson.Rating" class="fas fa-star"></span>
                        <span v-for="n in 5-lesson.Rating" class="far fa-star"></span> <br><br>
                        <button @click="addToCart(lesson)" :disabled="!canAddToCart(lesson)">Add to cart</button>
                    </div>
                </div>
            </ul>
        </div>
        <div v-else>
            <h1>Shopping Cart</h1>
            <button @click="showCheckout()">
                <span class="fas fa-book"> lessons</span>
            </button>
            <h2>Your cart</h2>
            <ul>
                <div v-for="(lesson, lessons) in cart" class="lessonlist">
                    <img v-bind:src="lesson.Image" alt="" width="100px" height="100px">
                    </span><br>
                    Subject: {{ lesson.Subject }} <br>
                    Location: {{ lesson.Location }} <br>
                    Price: £{{ lesson.Price }} <br>
                    <span v-for="n in lesson.Rating" class="fas fa-star"></span>
                    <span v-for="n in 5-lesson.Rating" class="far fa-star"></span> <br><br>
                    <button @click="removeFromCart(lesson)">Remove from cart</button>
                    <br>
                </div>
            </ul>


            <h2>Details</h2>
            <p>
                <strong>First Name: </strong>
                <input type="text" v-model.trim=order.firstName>
            </p>
            <p>
                <strong>Last Name: </strong>
                <input type="text" v-model.trim=order.lastName>
            </p>
            <p>
                <strong>Phone Number: </strong>
                <input type="text" v-model.trim=order.phoneNumber>
            </p>
            <input type="checkbox" value="gift" v-model=order.gift>
            <label>Ship as Gift?</label>
            <br>
            <br>
            <h3>Order Information</h3>
            <p>First Name: {{order.firstName}}</p>
            <p>Last Name: {{order.lastName}}</p>
            <p>Phone Number: {{order.phoneNumber}}</p>
            <p>Gift: {{order.gift}}</p>
            <button @Click="submitForm" :disabled="!correctOrderDetails">Checkout</button>
        </div>
    </div>


</body>
<script>
    let example2 = new Vue({
        el: '#example-2',
        data: {
            sitename: "Lessons",
            showProduct: "false",
            lessons: lessonsArray,
            cart: [],
            availableStock: 5,
            search: "",
            order: {
                firstName: "",
                lastName: "",
                phoneNumber: "",
                gift: false,
                correct: false
            },
            sort: {
                attribute: "",
                sortingOrder: "",
            }
        },
        methods: {
            addToCart(lesson) {
                console.log("added to cart");
                this.cart.push(lesson);
                lesson.Spaces--;
            },
            removeFromCart(lesson) {
                let index = this.cart.indexOf(lesson);
                this.cart.splice(index, 1);
                lesson.Spaces++;
            },
            showCheckout() {
                return this.showProduct = this.showProduct ? false : true;
            },
            submitForm() {
                alert("order submitted");
            },
            canAddToCart(lesson) {
                return lesson.Spaces > 0;
            },

        },
        computed: {
            cartItemCount() {
                return this.cart.length || '0';
            },
            cartEmpty() {
                return this.cart.length == 0;
            },
            correctOrderDetails(){
                let letters = /^[a-z]+$/i;
                let numbers = /^[0-9]+$/i;
                if (letters.test(this.order.firstName) &&
                    letters.test(this.order.lastName) && numbers.test(this.order.phoneNumber)) {
                    this.order.correct = true;   
                }
                else {
                    this.order.correct = false; 
                }
                return this.order.correct;
            },
            sortedLessons() {
                switch (this.sort.attribute) {
                    case "Subject":
                        if (this.sort.sortingOrder == "ascending") {
                            function compare(a, b) {
                                if (a.Subject < b.Subject)
                                    return -1;
                                if (a.Subject > b.Subject)
                                    return 1;
                                return 0;
                            }
                        }
                        else if (this.sort.sortingOrder == "descending") {
                            function compare(a, b) {
                                if (a.Subject > b.Subject)
                                    return -1;
                                if (a.Subject < b.Subject)
                                    return 1;
                                return 0;
                            }
                        }
                        break;
                    case "Price":
                        if (this.sort.sortingOrder == "ascending") {
                            function compare(a, b) {
                                if (a.Price < b.Price)
                                    return -1;
                                if (a.Price > b.Price)
                                    return 1;
                                return 0;
                            }
                        }
                        else if (this.sort.sortingOrder == "descending") {
                            function compare(a, b) {
                                if (a.Price > b.Price)
                                    return -1;
                                if (a.Price < b.Price)
                                    return 1;
                                return 0;
                            }
                        }
                        break;
                    case "Availability":
                        if (this.sort.sortingOrder == "ascending") {
                            function compare(a, b) {
                                if (a.Spaces < b.Spaces)
                                    return -1;
                                if (a.Spaces > b.Spaces)
                                    return 1;
                                return 0;
                            }
                        }
                        else if (this.sort.sortingOrder == "descending") {
                            function compare(a, b) {
                                if (a.Spaces > b.Spaces)
                                    return -1;
                                if (a.Spaces < b.Spaces)
                                    return 1;
                                return 0;
                            }
                        }
                        break;
                    case "Location":
                        if (this.sort.sortingOrder == "ascending") {
                            function compare(a, b) {
                                if (a.Location < b.Location)
                                    return -1;
                                if (a.Location > b.Location)
                                    return 1;
                                return 0;
                            }
                        }
                        else if (this.sort.sortingOrder == "descending") {
                            function compare(a, b) {
                                if (a.Location > b.Location)
                                    return -1;
                                if (a.Location < b.Location)
                                    return 1;
                                return 0;
                            }
                        }
                        break;
                    case "Rating":
                        if (this.sort.sortingOrder == "ascending") {
                            function compare(a, b) {
                                if (a.Rating < b.Rating)
                                    return -1;
                                if (a.Rating > b.Rating)
                                    return 1;
                                return 0;
                            }
                        }
                        else if (this.sort.sortingOrder == "descending") {
                            function compare(a, b) {
                                if (a.Rating > b.Rating)
                                    return -1;
                                if (a.Rating < b.Rating)
                                    return 1;
                                return 0;
                            }
                        }
                        break;
                }
                for (let i = 0; i < this.lessons.length; i++) {
                    let Subject = this.lessons[i].Subject.toLowerCase();
                    let Location = this.lessons[i].Location.toLowerCase();
                    if (!(Subject.includes(this.search.toLowerCase()) || Location.toLowerCase().includes(this.search.toLowerCase()))) {
                        this.lessons[i].Visible = false;
                    }
                    else{
                        this.lessons[i].Visible = true;
                    }
                }
                return this.lessons.sort(compare);
            }

        }

    })

</script>

</html>